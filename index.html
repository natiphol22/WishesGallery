<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>‡∏™‡∏°‡∏∏‡∏î‡∏≠‡∏ß‡∏¢‡∏û‡∏£‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå ‚Äî IG Feel</title>
  <!-- IG-style fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600&family=Grand+Hotel&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg:#fff;--text:#262626;--border:#dbdbdb;--accent:#3897f0;
      --radius:12px;--spacing:1rem;--shadow:0 4px 20px rgba(0,0,0,0.1);
      --transition:.3s ease;--max-width:480px;--nav-height:56px;
    }
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
    body{
      background:var(--bg);color:var(--text);
      font-family:'Sarabun',sans-serif;
      max-width:var(--max-width);margin:0 auto;
      padding-bottom:var(--nav-height);position:relative;
    }
    header{
      text-align:left;padding:var(--spacing) 0;
      border-bottom:1px solid var(--border);
    }
    header h1{
      font-family:'Grand Hotel',cursive;font-size:1.8rem;
      display:inline-block;padding-bottom:.25rem;
      border-bottom:2px solid var(--text);
      position:relative;
    }
    header h1::after{
      content:' ‚ô°';font-family:'Sarabun',sans-serif;
      font-size:1.2rem;vertical-align:middle;
    }
    header p{color:#8e8e8e;font-size:.9rem;margin-top:.25rem;}
    .gallery{
      padding:var(--spacing) 0 var(--spacing);
      display:flex;flex-direction:column;gap:var(--spacing);
    }
    .card{
      background:#fff;border:1px solid var(--border);
      border-radius:var(--radius);overflow:hidden;
      box-shadow:var(--shadow);transition:transform var(--transition);
      position:relative;
    }
    .card:hover{transform:translateY(-2px);}
    .card img{
      display:block;width:100%;aspect-ratio:4/5;object-fit:cover;
    }
    .card .info{
      padding:var(--spacing);font-size:.95rem;
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
    }
    .card .info .author{font-weight:600;margin-right:.25rem;}
    .card .like-btn{
      position:absolute;top:.5rem;right:.5rem;
      background:rgba(255,255,255,0.9);border:none;
      border-radius:50%;width:28px;height:28px;
      display:flex;align-items:center;justify-content:center;
      font-size:1rem;color:#262626;cursor:pointer;
      transition:transform .2s;z-index:1;
    }
    .card .like-btn:hover{transform:scale(1.2);}
    .bottom-nav{
      position:fixed;bottom:0;left:0;
      width:100%;height:var(--nav-height);
      background:#fff;border-top:1px solid var(--border);
      display:flex;justify-content:space-around;align-items:center;
      box-shadow:0 -1px 5px rgba(0,0,0,0.1);z-index:10;
    }
    .bottom-nav button{
      background:none;border:none;
      font-size:1.4rem;cursor:pointer;
      color:var(--text);transition:color var(--transition);
    }
    .bottom-nav button.primary{font-size:2rem;color:var(--accent);}
    .bottom-nav button:hover{color:var(--accent);}
    .modal{
      display:none;position:fixed;inset:0;
      background:rgba(0,0,0,0.5);
      align-items:center;justify-content:center;
      padding:var(--spacing);z-index:20;
    }
    .modal.show{display:flex;animation:fadeIn .2s ease-out;}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    .modal-content{
      background:#fff;border-radius:var(--radius);
      width:100%;max-width:400px;
      box-shadow:var(--shadow);overflow:hidden;
      animation:popIn .2s ease-out;
    }
    @keyframes popIn{from{opacity:0;transform:scale(.9)}to{opacity:1;transform:scale(1)}}
    .modal-header{
      display:flex;justify-content:space-between;align-items:center;
      padding:var(--spacing);border-bottom:1px solid var(--border);
    }
    .modal-header h2{font-size:1rem;}
    .modal-close{
      background:none;border:none;
      font-size:1.2rem;cursor:pointer;
    }
    .modal-body{
      padding:var(--spacing);
      display:flex;flex-direction:column;gap:var(--spacing);
    }
    .modal-body input[type="text"],
    .modal-body textarea{
      width:100%;border:1px solid var(--border);
      border-radius:var(--radius);padding:.75rem;
      font-size:.95rem;resize:vertical;
    }
    .modal-body .upload-btn{
      display:inline-flex;align-items:center;gap:.5rem;
      padding:.6rem 1rem;background:var(--accent);
      color:#fff;border:none;border-radius:var(--radius);
      cursor:pointer;transition:background var(--transition);
      font-size:.95rem;text-align:center;
    }
    .modal-body .upload-btn:hover{background:#2176c7;}
    .modal-body .upload-btn input{display:none;}
    .modal-body #preview{
      display:none;width:100%;aspect-ratio:4/5;
      object-fit:cover;border-radius:var(--radius);
    }
    .modal-footer{
      padding:var(--spacing);
      border-top:1px solid var(--border);
      text-align:right;
    }
    .modal-footer button{
      background:var(--accent);color:#fff;
      border:none;border-radius:var(--radius);
      padding:.5rem 1rem;font-weight:600;
      cursor:pointer;transition:background var(--transition);
    }
    .modal-footer button:disabled{opacity:.5;cursor:default;}
    .modal-footer button:hover:not(:disabled){background:#2176c7;}
    @keyframes popHeart{
      0%{transform:translate(-50%,-50%) scale(0);opacity:1;}
      50%{transform:translate(-50%,-50%) scale(1.2);opacity:.9;}
      100%{transform:translate(-50%,-50%) scale(1);opacity:0;}
    }
  </style>
</head>
<body>
  <header>
    <h1>Tuck&amp;Tan</h1>
    <p>‡∏ü‡∏µ‡∏•‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÅ‡∏ö‡∏ö IG</p>
  </header>

  <div class="gallery" id="gallery"></div>

  <nav class="bottom-nav">
    <button id="nav-home">üè†</button>
    <button id="nav-search">üîç</button>
    <button id="nav-add" class="primary">‚ûï</button>
    <button id="nav-heart">‚ù§Ô∏è</button>
    <button id="nav-profile">üë§</button>
  </nav>

  <div id="modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÉ‡∏´‡∏°‡πà</h2>
        <button id="modalClose" class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <input type="text" id="modalName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)">
        <textarea id="wishText" rows="4" placeholder="‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏≥‡∏≠‡∏ß‡∏¢‡∏û‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì..." required></textarea>
        <label class="upload-btn">
          üì∑ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ
          <input type="file" id="imgUpload" accept="image/*">
        </label>
        <img id="preview" alt="‡∏û‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏£‡∏π‡∏õ">
      </div>
      <div class="modal-footer">
        <button id="postBtn" disabled>‡πÇ‡∏û‡∏™‡∏ï‡πå</button>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
    import {
      getFirestore, serverTimestamp,
      collection, addDoc,
      query, orderBy, onSnapshot
    } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyBxYY_c14XFroS6dBIh4Jzl9XL4PMjipcg",
      authDomain: "wishes-web.firebaseapp.com",
      projectId: "wishes-web",
      storageBucket: "unused",
      messagingSenderId: "93224724611",
      appId: "1:93224724611:web:491aab34365584864fd3b6",
      measurementId: "G-6HQJWKWB8Z"
    };
    const app = initializeApp(firebaseConfig);
    const db  = getFirestore(app);

    document.addEventListener('DOMContentLoaded', () => {
      // DOM refs
      const gallery    = document.getElementById('gallery');
      const navAdd     = document.getElementById('nav-add');
      const modal      = document.getElementById('modal');
      const modalClose = document.getElementById('modalClose');
      const wishText   = document.getElementById('wishText');
      const modalName  = document.getElementById('modalName');
      const imgUpload  = document.getElementById('imgUpload');
      const preview    = document.getElementById('preview');
      const postBtn    = document.getElementById('postBtn');

      // UI events
      navAdd.onclick     = () => modal.classList.add('show');
      modalClose.onclick = () => modal.classList.remove('show');
      modal.onclick      = e => { if (e.target === modal) modal.classList.remove('show'); };
      wishText.oninput   = () => postBtn.disabled = !wishText.value.trim();
      imgUpload.onchange = e => {
        const file = e.target.files[0];
        if (!file) return preview.style.display = 'none';
        preview.src = URL.createObjectURL(file);
        preview.style.display = 'block';
      };

      // Real-time listener (load feed on page load)
      const q = query(collection(db,'wishes'), orderBy('createdAt','desc'));
      onSnapshot(q, snap => {
        gallery.innerHTML = '';
        snap.forEach(doc => createCard(doc.data()));
      });

      // Post new wish
      postBtn.onclick = async () => {
        const text = wishText.value.trim();
        if (!text) return;
        const name = modalName.value.trim() || '‡πÅ‡∏Ç‡∏Å‡∏ú‡∏π‡πâ‡∏°‡∏µ‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥';
        let imgUrl = 'https://via.placeholder.com/320x400?text=No+Image';

        if (imgUpload.files[0]) {
          const file = imgUpload.files[0];
          const img = await new Promise(r => {
            const i = new Image();
            i.onload = () => r(i);
            i.src = URL.createObjectURL(file);
          });
          const dpr = window.devicePixelRatio || 1;
          const max = 800 * dpr;
          let w = img.width, h = img.height;
          if (Math.max(w,h) > max) {
            const ratio = max / Math.max(w,h);
            w *= ratio; h *= ratio;
          }
          const canvas = document.createElement('canvas');
          canvas.width = w; canvas.height = h;
          const ctx = canvas.getContext('2d');
          ctx.imageSmoothingEnabled = true;
          ctx.imageSmoothingQuality = 'high';
          ctx.drawImage(img, 0, 0, w, h);

          let quality = 0.95, dataUrl;
          do {
            dataUrl = canvas.toDataURL('image/jpeg', quality);
            quality -= 0.05;
          } while (dataUrl.length > 1_000_000 && quality > 0.1);

          imgUrl = dataUrl;
        }

        await addDoc(collection(db,'wishes'), {
          name, text, imgUrl,
          createdAt: serverTimestamp()
        });

        // reset UI
        wishText.value = '';
        modalName.value = '';
        imgUpload.value = '';
        preview.style.display = 'none';
        postBtn.disabled = true;
        modal.classList.remove('show');
      };
    });

    // Create card helper
    function createCard(w) {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <img src="${w.imgUrl}" alt="">
        <button class="like-btn">‚ù§</button>
        <div class="info">
          <span class="author">${w.name}:</span>
          <span class="wish">${w.text}</span>
        </div>`;
      card.querySelector('.like-btn')
          .addEventListener('click', e => {
            e.stopPropagation();
            animateHeart(card);
          });
      document.getElementById('gallery').prepend(card);
    }

    // Heart animation helper
    function animateHeart(card) {
      const h = document.createElement('div');
      h.textContent = '‚ù§';
      h.style.cssText = `
        position:absolute;top:50%;left:50%;
        transform:translate(-50%,-50%) scale(0);
        font-size:3rem;color:rgba(255,0,0,0.8);
        animation:popHeart .6s forwards;`;
      card.appendChild(h);
      h.addEventListener('animationend', () => h.remove());
    }
  </script>
</body>
</html>
