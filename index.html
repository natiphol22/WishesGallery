<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Multi-Step Post (Vanilla JS)</title>
  <style>
    * { box-sizing: border-box; margin:0; padding:0 }
    body { font-family: Kanit, sans-serif; background:#f0f2f5; color:#262626; }
    .hidden { display: none!important }
    .step { position: fixed; top:0; left:0; right:0; bottom:0; background:#fff; display:flex; flex-direction:column; }
    .header { padding:1rem; background:#fafafa; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center; }
    .header .title { color:#666; }
    .content { flex:1; display:flex; justify-content:center; align-items:center; position:relative; }
    .btn { padding:.6rem 1rem; border:none; border-radius:8px; cursor:pointer; font-size:1rem; }
    .btn-primary { background:#405de6; color:#fff; }
    .btn-secondary { background:#ccc; color:#333; }
    /* STEP1 */
    #step1 .btn-open { font-size:2rem; width:56px; height:56px; line-height:56px; text-align:center; border-radius:50%; background:linear-gradient(135deg,#405de6,#5851db); color:#fff; border:none; }
    /* STEP2 */
    #step2 .slides { display:flex; width:100%; height:100%; overflow:hidden; touch-action: pan-y; }
    #step2 .slide { min-width:100%; position:relative; }
    #step2 img { width:100%; height:100%; object-fit:contain; filter:brightness(1.1) saturate(1.1) contrast(1.05); }
    #step2 .trash { position:absolute; top:10px; right:10px; background:rgba(255,255,255,0.8); border:none; border-radius:50%; padding:.4rem; cursor:pointer; }
    /* STEP3 */
    #step3 .form { padding:1rem; }
    #step3 .form input, #step3 .form textarea { width:100%; padding:.8rem; margin-bottom:1rem; border:1px solid #ddd; border-radius:8px; font-size:1rem; }
    /* STEP4 */
    #step4 { justify-content:center; align-items:center; text-align:center; padding:2rem; }
    #step4 h2 { margin-bottom:.5rem; }
    /* bottom nav placeholder to offset */
    #root { padding-bottom:60px; }
  </style>
</head>
<body>
  <div id="root">
    <!-- STEP 1 -->
    <div id="step1" class="step">
      <div class="header"><span class="title">STEP 1</span><span></span></div>
      <div class="content">
        <button class="btn-open" id="openBtn">Ôºã</button>
        <input type="file" id="fileInput" accept="image/*" multiple class="hidden">
      </div>
    </div>

    <!-- STEP 2 -->
    <div id="step2" class="step hidden">
      <div class="header">
        <span class="title">‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÉ‡∏´‡∏°‡πà</span>
        <button class="btn btn-primary" id="toStep3">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ &gt;</button>
      </div>
      <div class="content">
        <div class="slides" id="slidesContainer"></div>
      </div>
    </div>

    <!-- STEP 3 -->
    <div id="step3" class="step hidden">
      <div class="header">
        <button class="btn btn-secondary" id="backTo2">&lt; ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏°‡πà</button>
        <button class="btn btn-primary" id="postBtn" disabled>‡πÇ‡∏û‡∏™‡∏ï‡πå</button>
      </div>
      <div class="content">
        <div class="slides" id="slidesContainer3"></div>
      </div>
      <div class="form">
        <input type="text" id="nameInput" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
        <textarea id="textInput" rows="4" placeholder="‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏≥‡∏≠‡∏ß‡∏¢‡∏û‡∏£‡∏à‡∏≤‡∏Å‡πÉ‡∏à üíå"></textarea>
      </div>
    </div>

    <!-- STEP 4 -->
    <div id="step4" class="step hidden">
      <h2>üéâ ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏≠‡∏ß‡∏¢‡∏û‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì!</h2>
      <p>üíñ ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏£‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡πà‡∏≤</p>
      <button class="btn btn-secondary" id="resetBtn">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
    </div>
  </div>

  <script>
    (function(){
      const step1 = document.getElementById('step1');
      const step2 = document.getElementById('step2');
      const step3 = document.getElementById('step3');
      const step4 = document.getElementById('step4');
      const openBtn = document.getElementById('openBtn');
      const fileInput = document.getElementById('fileInput');
      const slides2 = document.getElementById('slidesContainer');
      const slides3 = document.getElementById('slidesContainer3');
      const toStep3 = document.getElementById('toStep3');
      const backTo2 = document.getElementById('backTo2');
      const postBtn = document.getElementById('postBtn');
      const resetBtn = document.getElementById('resetBtn');
      const nameInput = document.getElementById('nameInput');
      const textInput = document.getElementById('textInput');

      let files = [];
      let idx = 0;

      function show(el){ el.classList.remove('hidden'); }
      function hide(el){ el.classList.add('hidden'); }

      openBtn.addEventListener('click', ()=> fileInput.click());
      fileInput.addEventListener('change', e=>{
        files = Array.from(e.target.files);
        if(files.length){
          idx = 0;
          renderSlides(slides2, files, true);
          renderSlides(slides3, files, false);
          hide(step1); show(step2);
        }
      });

      toStep3.addEventListener('click', ()=>{
        hide(step2); show(step3);
        checkPostBtn();
      });
      backTo2.addEventListener('click', ()=>{
        hide(step3); show(step2);
      });
      resetBtn.addEventListener('click', ()=>{
        hide(step2); hide(step3); hide(step4);
        show(step1);
        fileInput.value = '';
        nameInput.value = '';
        textInput.value = '';
      });

      textInput.addEventListener('input', checkPostBtn);
      function checkPostBtn(){
        postBtn.disabled = !textInput.value.trim();
      }

      postBtn.addEventListener('click', ()=>{
        // ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏≤‡∏à‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏∂‡πâ‡∏ô Firestore ‡∏´‡∏£‡∏∑‡∏≠ API
        hide(step3); show(step4);
      });

      function renderSlides(container, fileList, withTrash){
        container.innerHTML = '';
        fileList.forEach((f,i)=>{
          const url = URL.createObjectURL(f);
          const div = document.createElement('div');
          div.className = 'slide';
          div.style.transform = `translateX(${(i-idx)*100}%)`;
          const img = document.createElement('img');
          img.src = url;
          div.appendChild(img);
          if(withTrash){
            const btn = document.createElement('button');
            btn.className = 'trash';
            btn.textContent = 'üóëÔ∏è';
            btn.addEventListener('click', ()=>{
              files.splice(i,1);
              if(files.length===0){
                resetBtn.click();
                return;
              }
              idx = idx % files.length;
              renderSlides(slides2, files, true);
              renderSlides(slides3, files, false);
            });
            div.appendChild(btn);
          }
          container.appendChild(div);
        });
      }

    })();
  </script>
</body>
</html>
