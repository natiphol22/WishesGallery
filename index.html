<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tuck & Tan</title>
  <!-- ‡∏ü‡∏≠‡∏ô‡∏ï‡πå Kanit -->
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet"/>
  <style>
    body, html {
      margin: 0; padding: 0;
      font-family: 'Kanit', sans-serif;
      background: #f0f2f5;
      color: #262626;
      height: 100%;
      overflow: hidden;
    }
    #root { height: 100%; position: relative; }

    /* ‡∏ü‡∏µ‡∏î */
    .feed {
      padding: 1rem;
      margin-bottom: 60px; /* space for bottom nav */
      overflow-y: auto;
      height: calc(100% - 60px);
    }
    .card {
      background: #fff; border-radius: 16px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.1);
      margin-bottom: 1rem; overflow: hidden; position: relative;
      transition: transform .2s;
    }
    .card:hover { transform: translateY(-4px); }
    .card img { width: 100%; display: block; }
    .like-indicator {
      display: flex; align-items: center; padding: .5rem 1rem;
      font-size: .9rem; cursor: pointer;
    }
    .heart-icon { margin-right: .25rem; color: #e0245e; }
    .info { padding: 0 1rem 1rem; font-size: .95rem; }
    .author { font-weight: 600; }
    .delete-btn {
      position: absolute; top:8px; left:8px;
      background: rgba(255,255,255,0.9); border:none;
      border-radius:50%; width:28px; height:28px;
      cursor:pointer; transition:transform .2s,color .2s;
    }
    .delete-btn:hover { transform:scale(1.2); color:#e0245e; }

    /* bottom nav */
    .bottom-nav {
      position: fixed; bottom:0; left:50%;
      transform: translateX(-50%);
      width:100%; height:60px;
      backdrop-filter: blur(12px);
      background: #ffffffdd;
      display:flex; justify-content:space-around; align-items:center;
      z-index:100; box-shadow:0 -2px 8px rgba(0,0,0,0.05);
    }
    .bottom-nav button {
      background:none; border:none;
      font-size:1.6rem; cursor:pointer;
      transition:transform .2s; color:#262626;
    }
    .bottom-nav .primary {
      font-size:2rem;
      background:linear-gradient(135deg,#405de6,#5851db);
      color:#fff; width:48px; height:48px;
      border-radius:50%; display:flex;
      align-items:center; justify-content:center;
      box-shadow:0 8px 24px rgba(0,0,0,0.1);
    }
    .bottom-nav button:hover { transform:scale(1.1); }

    /* Multi-step */
    .step {
      position:absolute; top:0; left:0; right:0; bottom:0;
      display:flex; flex-direction:column;
      background:#fff; z-index:200;
    }
    .header {
      padding:1rem; display:flex;
      justify-content:space-between; align-items:center;
      background:#fafafa; border-bottom:1px solid #eee;
    }
    .header .title { color:#666; font-size:1rem; }
    .btn {
      padding:.6rem 1.2rem; border:none; border-radius:8px;
      font-size:1rem; cursor:pointer;
    }
    .btn-primary { background:#405de6; color:#fff; }
    .btn-secondary { background:#ccc; color:#333; }

    .step1 { justify-content:center; align-items:center; }
    .step1 .btn-add { font-size:2rem; }

    .slider {
      flex:1; position:relative; overflow:hidden;
      background:#000;
    }
    .slides {
      display:flex; height:100%;
    }
    .slide {
      min-width:100%; display:flex;
      justify-content:center; align-items:center;
      position:relative;
    }
    .slide img {
      max-width:100%; max-height:100%;
      object-fit:cover;
      filter:brightness(1.1) saturate(1.1) contrast(1.05);
    }
    .slide .trash {
      position:absolute; top:10px; right:10px;
      background:rgba(255,255,255,0.8);
      border:none; border-radius:50%; padding:.4rem;
      cursor:pointer;
    }

    .form {
      padding:1rem; background:#fff;
    }
    .form input, .form textarea {
      width:100%; padding:.8rem; margin-bottom:1rem;
      border:1px solid #ddd; border-radius:8px;
      font-size:1rem;
    }

    .success {
      flex:1; display:flex; flex-direction:column;
      justify-content:center; align-items:center;
      text-align:center; padding:2rem;
    }

    .lightbox {
      position:fixed; inset:0;
      background:rgba(0,0,0,0.8);
      display:flex; justify-content:center; align-items:center;
      z-index:1000;
    }
    .lightbox img {
      max-width:90%; max-height:90%;
      object-fit:contain;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <!-- Firebase compat -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
  <!-- React / ReactDOM / Framer Motion -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/framer-motion/dist/framer-motion.umd.js"></script>

  <script>
    const { useState, useRef, useEffect } = React;
    const { motion, AnimatePresence } = window['framer-motion'];

    // init Firebase
    firebase.initializeApp({
      apiKey: "AIzaSyBxYY_c14XFroS6dBIh4Jzl9XL4PMjipcg",
      authDomain: "wishes-web.firebaseapp.com",
      projectId: "wishes-web"
    });
    const db = firebase.firestore();

    function App() {
      // feed
      const [posts, setPosts] = useState([]);
      const uid = useRef(localStorage.getItem('uid') || crypto.randomUUID());
      useEffect(() => {
        localStorage.setItem('uid', uid.current);
        return db.collection('wishes')
          .orderBy('createdAt','desc')
          .onSnapshot(snap => setPosts(snap.docs.map(d=>({ id:d.id, ...d.data() }))));
      }, []);

      const handleLike = async (id,w) => {
        if ((w.likedBy||[]).includes(uid.current)) return;
        await db.collection('wishes').doc(id).update({
          likes: (w.likes||0)+1,
          likedBy: [...(w.likedBy||[]), uid.current]
        });
      };
      const deletePost = async id => {
        if (confirm('‡∏•‡∏ö‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ô‡∏µ‡πâ?')) await db.collection('wishes').doc(id).delete();
      };

      // multi-step
      const [step, setStep] = useState(1);
      const [files, setFiles] = useState([]);
      const [index, setIndex] = useState(0);
      const [name, setName] = useState('');
      const [text, setText] = useState('');
      const [showLB, setShowLB] = useState(false);
      const fileInput = useRef();
      const touchStartX = useRef(0);

      const onAdd = () => fileInput.current.click();
      const onFiles = e => {
        const sel = Array.from(e.target.files).map(f=>URL.createObjectURL(f));
        if (sel.length) { setFiles(sel); setIndex(0); setStep(2); }
      };
      const next2 = () => setStep(3);
      const removeCur = () => {
        const arr = [...files];
        arr.splice(index,1);
        if (!arr.length) return setStep(1);
        setFiles(arr);
        setIndex(i=>i%arr.length);
      };
      const slide = dir => setIndex(i=>(i+dir+files.length)%files.length);
      const onPost = async () => {
        await db.collection('wishes').add({
          name: name||'‡πÅ‡∏Ç‡∏Å‡∏ú‡∏π‡πâ‡∏°‡∏µ‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥',
          text, imgUrl: files[index],
          likes:0, likedBy:[], uid:uid.current,
          createdAt: firebase.firestore.Timestamp.now()
        });
        setStep(4);
      };
      const resetAll = () => {
        setStep(1); setFiles([]); setName(''); setText('');
      };

      return (
        <div style={{height:'100%', position:'relative'}}>
          {/* feed */}
          <div className="feed">
            {posts.map(w=>(
              <div key={w.id} className="card">
                <img src={w.imgUrl}/>
                {w.uid===uid.current && (
                  <button className="delete-btn" onClick={()=>deletePost(w.id)}>üóëÔ∏è</button>
                )}
                <div className="like-indicator" onDoubleClick={()=>handleLike(w.id,w)}>
                  <span className="heart-icon">‚ô•</span><span>{w.likes||0}</span>
                </div>
                <div className="info"><span className="author">{w.name}:</span> {w.text}</div>
              </div>
            ))}
          </div>

          {/* bottom nav */}
          <nav className="bottom-nav">
            <button>üè†</button>
            <button>üîç</button>
            <button className="primary" onClick={()=>setStep(1)}>Ôºã</button>
            <button>‚ù§Ô∏è</button>
            <button>üë§</button>
          </nav>

          {/* multi-step */}
          <AnimatePresence initial={false} mode="wait">
            {step===1 && (
              <motion.div key="s1" className="step"
                initial={{opacity:0}} animate={{opacity:1}} exit={{opacity:0}}>
                <button className="btn btn-primary btn-add" onClick={onAdd}>Ôºã ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏û‡∏™‡∏ï‡πå</button>
                <input ref={fileInput} type="file" accept="image/*"
                  multiple style={{display:'none'}} onChange={onFiles}/>
              </motion.div>
            )}
            {step===2 && (
              <motion.div key="s2" className="step"
                initial={{x:'100%'}} animate={{x:0}} exit={{x:'-100%'}}
                transition={{type:'tween'}}>
                <div className="header">
                  <span className="title">‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÉ‡∏´‡∏°‡πà</span>
                  <button className="btn btn-primary" onClick={next2}>‡∏ñ‡∏±‡∏î‡πÑ‡∏õ &gt;</button>
                </div>
                <div className="slider"
                  onTouchStart={e=>touchStartX.current=e.touches[0].clientX}
                  onTouchEnd={e=>{
                    const dx = e.changedTouches[0].clientX - touchStartX.current;
                    if (dx>50) slide(-1); else if (dx<-50) slide(1);
                  }}>
                  <div className="slides">
                    {files.map((url,i)=>(
                      <div key={i} className="slide"
                        style={{transform:`translateX(${(i-index)*100}%)`}}>
                        <img src={url}/>
                        <button className="trash" onClick={removeCur}>üóëÔ∏è</button>
                      </div>
                    ))}
                  </div>
                </div>
              </motion.div>
            )}
            {step===3 && (
              <motion.div key="s3" className="step"
                initial={{y:'100%'}} animate={{y:0}} exit={{y:'-100%'}}
                transition={{type:'spring'}}>
                <div className="header">
                  <button className="btn btn-secondary" onClick={()=>setStep(2)}>
                    &lt; ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏°‡πà
                  </button>
                  <button className="btn btn-primary" disabled={!text.trim()} onClick={onPost}>
                    ‡πÇ‡∏û‡∏™‡∏ï‡πå
                  </button>
                </div>
                <div className="slider"
                  onTouchStart={e=>touchStartX.current=e.touches[0].clientX}
                  onTouchEnd={e=>{
                    const dx = e.changedTouches[0].clientX - touchStartX.current;
                    if (dx>50) slide(-1); else if (dx<-50) slide(1);
                  }}>
                  <div className="slides">
                    {files.map((url,i)=>(
                      <div key={i} className="slide"
                        style={{transform:`translateX(${(i-index)*100}%)`}}>
                        <img src={url}/>
                      </div>
                    ))}
                  </div>
                </div>
                <div className="form">
                  <input type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì"
                    value={name} onChange={e=>setName(e.target.value)}/>
                  <textarea rows="4" placeholder="‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏≥‡∏≠‡∏ß‡∏¢‡∏û‡∏£‡∏à‡∏≤‡∏Å‡πÉ‡∏à üíå"
                    value={text} onChange={e=>setText(e.target.value)}/>
                </div>
              </motion.div>
            )}
            {step===4 && (
              <motion.div key="s4" className="step success"
                initial={{scale:0.8,opacity:0}} animate={{scale:1,opacity:1}} exit={{opacity:0}}>
                <h2>üéâ ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏≠‡∏ß‡∏¢‡∏û‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì!</h2>
                <p>üíñ ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏£‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡πà‡∏≤</p>
                <div style={{marginTop:'1.5rem'}}>
                  <button className="btn btn-secondary" onClick={resetAll}>
                    ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å
                  </button>
                  <button className="btn btn-primary" style={{marginLeft:'1rem'}}
                    onClick={()=>setShowLB(true)}>
                    ‡∏î‡∏π‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                  </button>
                </div>
              </motion.div>
            )}
          </AnimatePresence>

          {/* lightbox */}
          {showLB && (
            <div className="lightbox" onClick={()=>setShowLB(false)}>
              <img src={files[index]||''}/>
            </div>
          )}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>
